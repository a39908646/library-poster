import{d as U,h as $,s as he,j as L,l as N,k as I,g as O,aj as J,K as ge,L as me,a as ke,u as we,z as oe,r as w,b as ye,B as xe,C as Ce,c as q,E as Z,t as Q,p as _e,f as X,ak as Re,x as Ne,al as ze,Z as y,_ as A,$ as b,a0 as Be,I as Ie,a2 as P,a3 as o,a4 as t,a5 as z,a6 as T,a7 as r,a8 as Y,ac as c,ad as S,ag as W,ae as Se,af as $e,ab as j,a9 as K,ah as Fe,ai as Ve}from"./index-D9ClbKiL.js";import{N as Ee}from"./Alert-BklwJxyo.js";import{A as Me}from"./AddOutline-DxrtwUNI.js";import{s as Te,r as je,a as De,b as Ae}from"./use-radio-ClXrA69Y.js";import{N as Ue}from"./DynamicTags-DAcdd4uU.js";import{u as Le}from"./use-message-COH_f0X2.js";import{N as Oe,a as G,b as ee}from"./text-_LmCWHMF.js";import{N as Pe}from"./Spin-QnsRd-BB.js";import{N as Ke,a as We,b as Ge}from"./Thing-B_cl8MzG.js";import{N as He,a as qe,b as D,c as H}from"./FormItem-C1ZGp56x.js";const te=U({name:"RadioButton",props:je,setup:Te,render(){const{mergedClsPrefix:a}=this;return $("label",{class:[`${a}-radio-button`,this.mergedDisabled&&`${a}-radio-button--disabled`,this.renderSafeChecked&&`${a}-radio-button--checked`,this.focus&&[`${a}-radio-button--focus`]]},$("input",{ref:"inputRef",type:"radio",class:`${a}-radio-input`,value:this.value,name:this.mergedName,checked:this.renderSafeChecked,disabled:this.mergedDisabled,onChange:this.handleRadioInputChange,onFocus:this.handleRadioInputFocus,onBlur:this.handleRadioInputBlur}),$("div",{class:`${a}-radio-button__state-border`}),he(this.$slots.default,u=>!u&&!this.label?null:$("div",{ref:"labelRef",class:`${a}-radio__label`},u||this.label)))}}),Je=L("radio-group",`
 display: inline-block;
 font-size: var(--n-font-size);
`,[N("splitor",`
 display: inline-block;
 vertical-align: bottom;
 width: 1px;
 transition:
 background-color .3s var(--n-bezier),
 opacity .3s var(--n-bezier);
 background: var(--n-button-border-color);
 `,[I("checked",{backgroundColor:"var(--n-button-border-color-active)"}),I("disabled",{opacity:"var(--n-opacity-disabled)"})]),I("button-group",`
 white-space: nowrap;
 height: var(--n-height);
 line-height: var(--n-height);
 `,[L("radio-button",{height:"var(--n-height)",lineHeight:"var(--n-height)"}),N("splitor",{height:"var(--n-height)"})]),L("radio-button",`
 vertical-align: bottom;
 outline: none;
 position: relative;
 user-select: none;
 -webkit-user-select: none;
 display: inline-block;
 box-sizing: border-box;
 padding-left: 14px;
 padding-right: 14px;
 white-space: nowrap;
 transition:
 background-color .3s var(--n-bezier),
 opacity .3s var(--n-bezier),
 border-color .3s var(--n-bezier),
 color .3s var(--n-bezier);
 background: var(--n-button-color);
 color: var(--n-button-text-color);
 border-top: 1px solid var(--n-button-border-color);
 border-bottom: 1px solid var(--n-button-border-color);
 `,[L("radio-input",`
 pointer-events: none;
 position: absolute;
 border: 0;
 border-radius: inherit;
 left: 0;
 right: 0;
 top: 0;
 bottom: 0;
 opacity: 0;
 z-index: 1;
 `),N("state-border",`
 z-index: 1;
 pointer-events: none;
 position: absolute;
 box-shadow: var(--n-button-box-shadow);
 transition: box-shadow .3s var(--n-bezier);
 left: -1px;
 bottom: -1px;
 right: -1px;
 top: -1px;
 `),O("&:first-child",`
 border-top-left-radius: var(--n-button-border-radius);
 border-bottom-left-radius: var(--n-button-border-radius);
 border-left: 1px solid var(--n-button-border-color);
 `,[N("state-border",`
 border-top-left-radius: var(--n-button-border-radius);
 border-bottom-left-radius: var(--n-button-border-radius);
 `)]),O("&:last-child",`
 border-top-right-radius: var(--n-button-border-radius);
 border-bottom-right-radius: var(--n-button-border-radius);
 border-right: 1px solid var(--n-button-border-color);
 `,[N("state-border",`
 border-top-right-radius: var(--n-button-border-radius);
 border-bottom-right-radius: var(--n-button-border-radius);
 `)]),J("disabled",`
 cursor: pointer;
 `,[O("&:hover",[N("state-border",`
 transition: box-shadow .3s var(--n-bezier);
 box-shadow: var(--n-button-box-shadow-hover);
 `),J("checked",{color:"var(--n-button-text-color-hover)"})]),I("focus",[O("&:not(:active)",[N("state-border",{boxShadow:"var(--n-button-box-shadow-focus)"})])])]),I("checked",`
 background: var(--n-button-color-active);
 color: var(--n-button-text-color-active);
 border-color: var(--n-button-border-color-active);
 `),I("disabled",`
 cursor: not-allowed;
 opacity: var(--n-opacity-disabled);
 `)])]);function Ze(a,u,s){var g;const f=[];let h=!1;for(let v=0;v<a.length;++v){const d=a[v],k=(g=d.type)===null||g===void 0?void 0:g.name;k==="RadioButton"&&(h=!0);const C=d.props;if(k!=="RadioButton"){f.push(d);continue}if(v===0)f.push(d);else{const i=f[f.length-1].props,B=u===i.value,_=i.disabled,x=u===C.value,R=C.disabled,F=(B?2:0)+(_?0:1),V=(x?2:0)+(R?0:1),E={[`${s}-radio-group__splitor--disabled`]:_,[`${s}-radio-group__splitor--checked`]:B},M={[`${s}-radio-group__splitor--disabled`]:R,[`${s}-radio-group__splitor--checked`]:x},l=F<V?M:E;f.push($("div",{class:[`${s}-radio-group__splitor`,l]}),d)}}return{children:f,isButtonGroup:h}}const Qe=Object.assign(Object.assign({},oe.props),{name:String,value:[String,Number,Boolean],defaultValue:{type:[String,Number,Boolean],default:null},size:String,disabled:{type:Boolean,default:void 0},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array]}),Xe=U({name:"RadioGroup",props:Qe,setup(a){const u=w(null),{mergedSizeRef:s,mergedDisabledRef:g,nTriggerFormChange:f,nTriggerFormInput:h,nTriggerFormBlur:v,nTriggerFormFocus:d}=ke(a),{mergedClsPrefixRef:k,inlineThemeDisabled:C,mergedRtlRef:i}=we(a),B=oe("Radio","-radio-group",Je,De,a,k),_=w(a.defaultValue),x=Q(a,"value"),R=ye(x,_);function F(n){const{onUpdateValue:p,"onUpdate:value":m}=a;p&&X(p,n),m&&X(m,n),_.value=n,f(),h()}function V(n){const{value:p}=u;p&&(p.contains(n.relatedTarget)||d())}function E(n){const{value:p}=u;p&&(p.contains(n.relatedTarget)||v())}_e(Ae,{mergedClsPrefixRef:k,nameRef:Q(a,"name"),valueRef:R,disabledRef:g,mergedSizeRef:s,doUpdateValue:F});const M=xe("Radio",i,k),l=q(()=>{const{value:n}=s,{common:{cubicBezierEaseInOut:p},self:{buttonBorderColor:m,buttonBorderColorActive:re,buttonBorderRadius:ne,buttonBoxShadow:ae,buttonBoxShadowFocus:le,buttonBoxShadowHover:se,buttonColor:ie,buttonColorActive:ue,buttonTextColor:de,buttonTextColorActive:ce,buttonTextColorHover:pe,opacityDisabled:be,[Z("buttonHeight",n)]:ve,[Z("fontSize",n)]:fe}}=B.value;return{"--n-font-size":fe,"--n-bezier":p,"--n-button-border-color":m,"--n-button-border-color-active":re,"--n-button-border-radius":ne,"--n-button-box-shadow":ae,"--n-button-box-shadow-focus":le,"--n-button-box-shadow-hover":se,"--n-button-color":ie,"--n-button-color-active":ue,"--n-button-text-color":de,"--n-button-text-color-hover":pe,"--n-button-text-color-active":ce,"--n-height":ve,"--n-opacity-disabled":be}}),e=C?Ce("radio-group",q(()=>s.value[0]),l,a):void 0;return{selfElRef:u,rtlEnabled:M,mergedClsPrefix:k,mergedValue:R,handleFocusout:E,handleFocusin:V,cssVars:C?void 0:l,themeClass:e==null?void 0:e.themeClass,onRender:e==null?void 0:e.onRender}},render(){var a;const{mergedValue:u,mergedClsPrefix:s,handleFocusin:g,handleFocusout:f}=this,{children:h,isButtonGroup:v}=Ze(ge(me(this)),u,s);return(a=this.onRender)===null||a===void 0||a.call(this),$("div",{onFocusin:g,onFocusout:f,ref:"selfElRef",class:[`${s}-radio-group`,this.rtlEnabled&&`${s}-radio-group--rtl`,this.themeClass,v&&`${s}-radio-group--button-group`],style:this.cssVars},h)}});function Ye(){const a=Ne(ze,null);return a===null&&Re("use-dialog","No outer <n-dialog-provider /> founded."),a}const et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},tt=U({name:"CreateOutline",render:function(u,s){return y(),A("svg",et,s[0]||(s[0]=[b("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),b("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),b("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1)]))}}),ot={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},rt=U({name:"LinkOutline",render:function(u,s){return y(),A("svg",ot,s[0]||(s[0]=[b("path",{d:"M208 352h-64a96 96 0 0 1 0-192h64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),b("path",{d:"M304 160h64a96 96 0 0 1 0 192h-64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),b("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36",d:"M163.29 256h187.42"},null,-1)]))}}),nt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},at=U({name:"TrashOutline",render:function(u,s){return y(),A("svg",nt,s[0]||(s[0]=[Be('<path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352" fill="currentColor"></path><path d="M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 176v224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M184 176l8 224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M328 176l-8 224"></path>',6)]))}}),lt={key:0},gt={__name:"Servers",setup(a){const u=Le(),s=Ye(),g=w(!1),f=w(!1),h=w([]),v=w(!1),d=w(-1),k=w(null),C=q(()=>window.location.origin),i=w({name:"",type:"emby",url:"",api_key:"",exclude_libraries:[]}),B={name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],type:[{required:!0,message:"请选择服务器类型",trigger:"change"}],url:[{required:!0,message:"请输入服务器地址",trigger:"blur"},{validator:(l,e)=>e&&!e.startsWith("http://")&&!e.startsWith("https://")?new Error("地址必须以 http:// 或 https:// 开头"):!0,trigger:"blur"}],api_key:[{required:!0,validator:(l,e)=>d.value===-1&&!e?new Error("请输入 API Key"):!0,trigger:"blur"}]},_=l=>!l||l==="***MASKED***"?"******":l.length<8?"***":l.substring(0,4)+"***"+l.substring(l.length-4),x=async()=>{g.value=!0;try{const l=await T.getConfig();h.value=l.servers||[]}catch(l){u.error("加载服务器列表失败: "+l.message)}finally{g.value=!1}},R=()=>{d.value=-1,i.value={name:"",type:"emby",url:"",api_key:"",exclude_libraries:[]},v.value=!0},F=l=>{d.value=l;const e=h.value[l];i.value={name:e.name,type:e.type,url:e.url,api_key:"",exclude_libraries:[...e.exclude_libraries||[]]},v.value=!0},V=async()=>{var l;try{await((l=k.value)==null?void 0:l.validate())}catch{return}f.value=!0;try{const e=await T.getFullConfig(),n=[...e.servers||[]],p={name:i.value.name,type:i.value.type,url:i.value.url,api_key:i.value.api_key||(d.value>=0?n[d.value].api_key:""),exclude_libraries:i.value.exclude_libraries};if(d.value===-1){if(n.some(m=>m.name===p.name)){u.error("服务器名称已存在");return}n.push(p)}else n[d.value]=p;e.servers=n,await T.saveConfig(e),u.success(d.value===-1?"服务器已添加":"服务器已更新"),v.value=!1,await x()}catch(e){u.error("保存失败: "+e.message)}finally{f.value=!1}},E=l=>{const e=h.value[l];s.warning({title:"确认删除",content:`确定要删除服务器「${e.name}」吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:()=>M(l)})},M=async l=>{try{const e=await T.getFullConfig();e.servers.splice(l,1),await T.saveConfig(e),u.success("服务器已删除"),await x()}catch(e){u.error("删除失败: "+e.message)}};return Ie(()=>{x()}),(l,e)=>(y(),P(t(z),{vertical:"",size:16},{default:o(()=>[r(t(Y),{title:"Webhook 配置"},{default:o(()=>[r(t(Ee),{type:"info","show-icon":!0},{header:o(()=>[...e[7]||(e[7]=[c("在 Emby/Jellyfin 中配置 Webhook（媒体入库自动更新封面）",-1)])]),default:o(()=>[r(t(z),{vertical:""},{default:o(()=>[e[11]||(e[11]=b("div",null,[b("strong",null,"1. 安装 Webhook 插件"),c("（Emby 插件目录搜索 Webhook）")],-1)),e[12]||(e[12]=b("div",null,[b("strong",null,"2. 添加 Webhook，配置如下：")],-1)),r(t(Oe),{bordered:"",column:1,size:"small",style:{margin:"8px 0"}},{default:o(()=>[r(t(G),{label:"网址"},{default:o(()=>[r(t(ee),{code:""},{default:o(()=>[c(S(C.value)+"/webhook/emby",1)]),_:1}),r(t(ee),{depth:"3"},{default:o(()=>[...e[8]||(e[8]=[c("（Jellyfin 用 /webhook/jellyfin）",-1)])]),_:1})]),_:1}),r(t(G),{label:"请求内容类型"},{default:o(()=>[r(t(W),{type:"success"},{default:o(()=>[...e[9]||(e[9]=[c("application/json",-1)])]),_:1})]),_:1}),r(t(G),{label:"事件类型"},{default:o(()=>[r(t(z),null,{default:o(()=>[r(t(W),{type:"info"},{default:o(()=>[...e[10]||(e[10]=[c("✓ 媒体库 - 已添加新媒体",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e[13]||(e[13]=b("div",null,[b("strong",null,'3. 保存后点击"发送测试通知"验证')],-1))]),_:1})]),_:1})]),_:1}),r(t(Y),{title:"服务器管理"},{"header-extra":o(()=>[r(t(j),{type:"primary",onClick:R},{icon:o(()=>[r(t(K),{component:t(Me)},null,8,["component"])]),default:o(()=>[e[14]||(e[14]=c(" 添加服务器 ",-1))]),_:1})]),default:o(()=>[r(t(Pe),{show:g.value},{default:o(()=>[h.value.length>0?(y(),P(t(Ke),{key:0,bordered:""},{default:o(()=>[(y(!0),A(Se,null,$e(h.value,(n,p)=>(y(),P(t(We),{key:n.name},{default:o(()=>[r(t(Ge),null,{header:o(()=>[r(t(z),{align:"center"},{default:o(()=>[c(S(n.name)+" ",1),r(t(W),{type:n.type==="emby"?"success":"info",size:"small"},{default:o(()=>[c(S(n.type.toUpperCase()),1)]),_:2},1032,["type"])]),_:2},1024)]),description:o(()=>[r(t(z),{vertical:"",size:"small"},{default:o(()=>{var m;return[b("div",null,[e[15]||(e[15]=b("strong",null,"URL:",-1)),c(" "+S(n.url),1)]),b("div",null,[e[16]||(e[16]=b("strong",null,"API Key:",-1)),c(" "+S(_(n.api_key)),1)]),(m=n.exclude_libraries)!=null&&m.length?(y(),A("div",lt,[e[17]||(e[17]=b("strong",null,"排除媒体库:",-1)),c(" "+S(n.exclude_libraries.join(", ")),1)])):Fe("",!0)]}),_:2},1024)]),action:o(()=>[r(t(z),null,{default:o(()=>[r(t(j),{size:"small",onClick:m=>F(p)},{icon:o(()=>[r(t(K),{component:t(tt)},null,8,["component"])]),default:o(()=>[e[18]||(e[18]=c(" 编辑 ",-1))]),_:1},8,["onClick"]),r(t(j),{size:"small",type:"error",onClick:m=>E(p)},{icon:o(()=>[r(t(K),{component:t(at)},null,8,["component"])]),default:o(()=>[e[19]||(e[19]=c(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(y(),P(t(He),{key:1,description:"暂无服务器，点击上方按钮添加"}))]),_:1},8,["show"])]),_:1}),r(t(Ve),{show:v.value,"onUpdate:show":e[6]||(e[6]=n=>v.value=n),preset:"dialog",title:d.value===-1?"添加服务器":"编辑服务器"},{action:o(()=>[r(t(z),null,{default:o(()=>[r(t(j),{onClick:e[5]||(e[5]=n=>v.value=!1)},{default:o(()=>[...e[22]||(e[22]=[c("取消",-1)])]),_:1}),r(t(j),{type:"primary",onClick:V,loading:f.value},{default:o(()=>[...e[23]||(e[23]=[c("保存",-1)])]),_:1},8,["loading"])]),_:1})]),default:o(()=>[r(t(qe),{ref_key:"formRef",ref:k,model:i.value,rules:B,"label-placement":"left","label-width":"100"},{default:o(()=>[r(t(D),{label:"服务器名称",path:"name"},{default:o(()=>[r(t(H),{value:i.value.name,"onUpdate:value":e[0]||(e[0]=n=>i.value.name=n),placeholder:"例如：我的Emby"},null,8,["value"])]),_:1}),r(t(D),{label:"服务器类型",path:"type"},{default:o(()=>[r(t(Xe),{value:i.value.type,"onUpdate:value":e[1]||(e[1]=n=>i.value.type=n)},{default:o(()=>[r(t(te),{value:"emby"},{default:o(()=>[...e[20]||(e[20]=[c("Emby",-1)])]),_:1}),r(t(te),{value:"jellyfin"},{default:o(()=>[...e[21]||(e[21]=[c("Jellyfin",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),r(t(D),{label:"服务器地址",path:"url"},{default:o(()=>[r(t(H),{value:i.value.url,"onUpdate:value":e[2]||(e[2]=n=>i.value.url=n),placeholder:"http://192.168.1.100:8096"},{prefix:o(()=>[r(t(K),{component:t(rt)},null,8,["component"])]),_:1},8,["value"])]),_:1}),r(t(D),{label:"API Key",path:"api_key"},{default:o(()=>[r(t(H),{value:i.value.api_key,"onUpdate:value":e[3]||(e[3]=n=>i.value.api_key=n),type:"password","show-password-on":"click",placeholder:d.value===-1?"从媒体服务器后台获取":"留空不修改"},null,8,["value","placeholder"])]),_:1}),r(t(D),{label:"排除媒体库"},{default:o(()=>[r(t(Ue),{value:i.value.exclude_libraries,"onUpdate:value":e[4]||(e[4]=n=>i.value.exclude_libraries=n)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]),_:1}))}};export{gt as default};
