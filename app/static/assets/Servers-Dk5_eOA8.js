import{a7 as J,s as P,a8 as G,d as T,J as f,K as N,L as u,M as H,O as Q,Q as _,R as t,T as l,U as v,V as b,r as m,X as r,Y as B,a0 as s,a1 as c,a4 as A,a2 as X,a3 as Y,$ as x,Z as M,a5 as Z,a6 as ee,c as le}from"./index-DXdFuH5K.js";import{N as te}from"./Alert-DCbZTzLS.js";import{A as re,N as ae}from"./AddOutline-Cdw8vucD.js";import{N as ne,a as D}from"./RadioGroup-BfjwGpzz.js";import{u as oe,N as se}from"./Spin-DElXLdiL.js";import{N as ue,a as I,b as V}from"./text-CMTz8ZZs.js";import{N as ie,a as de,b as pe}from"./Thing-DskFXyIs.js";import{N as fe,a as ve,b as C,c as S}from"./FormItem-jJsAIIqM.js";function me(){const k=P(G,null);return k===null&&J("use-dialog","No outer <n-dialog-provider /> founded."),k}const ke={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ge=T({name:"CreateOutline",render:function(p,i){return f(),N("svg",ke,i[0]||(i[0]=[u("path",{d:"M384 224v184a40 40 0 0 1-40 40H104a40 40 0 0 1-40-40V168a40 40 0 0 1 40-40h167.48",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),u("path",{d:"M459.94 53.25a16.06 16.06 0 0 0-23.22-.56L424.35 65a8 8 0 0 0 0 11.31l11.34 11.32a8 8 0 0 0 11.34 0l12.06-12c6.1-6.09 6.67-16.01.85-22.38z",fill:"currentColor"},null,-1),u("path",{d:"M399.34 90L218.82 270.2a9 9 0 0 0-2.31 3.93L208.16 299a3.91 3.91 0 0 0 4.86 4.86l24.85-8.35a9 9 0 0 0 3.93-2.31L422 112.66a9 9 0 0 0 0-12.66l-9.95-10a9 9 0 0 0-12.71 0z",fill:"currentColor"},null,-1)]))}}),we={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ye=T({name:"LinkOutline",render:function(p,i){return f(),N("svg",we,i[0]||(i[0]=[u("path",{d:"M208 352h-64a96 96 0 0 1 0-192h64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),u("path",{d:"M304 160h64a96 96 0 0 1 0 192h-64",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36"},null,-1),u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"36",d:"M163.29 256h187.42"},null,-1)]))}}),ce={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},he=T({name:"TrashOutline",render:function(p,i){return f(),N("svg",ce,i[0]||(i[0]=[H('<path d="M112 112l20 320c.95 18.49 14.4 32 32 32h184c17.67 0 30.87-13.51 32-32l20-320" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="32" d="M80 112h352" fill="currentColor"></path><path d="M192 112V72h0a23.93 23.93 0 0 1 24-24h80a23.93 23.93 0 0 1 24 24h0v40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M256 176v224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M184 176l8 224"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32" d="M328 176l-8 224"></path>',6)]))}}),be={key:0},Ae={__name:"Servers",setup(k){const p=oe(),i=me(),j=m(!1),E=m(!1),h=m([]),g=m(!1),d=m(-1),U=m(null),z=le(()=>window.location.origin),o=m({name:"",type:"emby",url:"",api_key:"",exclude_libraries:[]}),O={name:[{required:!0,message:"请输入服务器名称",trigger:"blur"}],type:[{required:!0,message:"请选择服务器类型",trigger:"change"}],url:[{required:!0,message:"请输入服务器地址",trigger:"blur"},{validator:(n,e)=>e&&!e.startsWith("http://")&&!e.startsWith("https://")?new Error("地址必须以 http:// 或 https:// 开头"):!0,trigger:"blur"}],api_key:[{required:!0,validator:(n,e)=>d.value===-1&&!e?new Error("请输入 API Key"):!0,trigger:"blur"}]},$=n=>!n||n==="***MASKED***"?"******":n.length<8?"***":n.substring(0,4)+"***"+n.substring(n.length-4),L=async()=>{j.value=!0;try{const n=await b.getConfig();h.value=n.servers||[]}catch(n){p.error("加载服务器列表失败: "+n.message)}finally{j.value=!1}},K=()=>{d.value=-1,o.value={name:"",type:"emby",url:"",api_key:"",exclude_libraries:[]},g.value=!0},R=n=>{d.value=n;const e=h.value[n];o.value={name:e.name,type:e.type,url:e.url,api_key:"",exclude_libraries:[...e.exclude_libraries||[]]},g.value=!0},W=async()=>{var n;try{await((n=U.value)==null?void 0:n.validate())}catch{return}E.value=!0;try{const e=await b.getFullConfig(),a=[...e.servers||[]],w={name:o.value.name,type:o.value.type,url:o.value.url,api_key:o.value.api_key||(d.value>=0?a[d.value].api_key:""),exclude_libraries:o.value.exclude_libraries};if(d.value===-1){if(a.some(y=>y.name===w.name)){p.error("服务器名称已存在");return}a.push(w)}else a[d.value]=w;e.servers=a,await b.saveConfig(e),p.success(d.value===-1?"服务器已添加":"服务器已更新"),g.value=!1,await L()}catch(e){p.error("保存失败: "+e.message)}finally{E.value=!1}},F=n=>{const e=h.value[n];i.warning({title:"确认删除",content:`确定要删除服务器「${e.name}」吗？`,positiveText:"删除",negativeText:"取消",onPositiveClick:()=>q(n)})},q=async n=>{try{const e=await b.getFullConfig();e.servers.splice(n,1),await b.saveConfig(e),p.success("服务器已删除"),await L()}catch(e){p.error("删除失败: "+e.message)}};return Q(()=>{L()}),(n,e)=>(f(),_(l(v),{vertical:"",size:16},{default:t(()=>[r(l(B),{title:"Webhook 配置"},{default:t(()=>[r(l(te),{type:"info","show-icon":!0},{header:t(()=>[...e[7]||(e[7]=[s("在 Emby/Jellyfin 中配置 Webhook（媒体入库自动更新封面）",-1)])]),default:t(()=>[r(l(v),{vertical:""},{default:t(()=>[e[11]||(e[11]=u("div",null,[u("strong",null,"1. 安装 Webhook 插件"),s("（Emby 插件目录搜索 Webhook）")],-1)),e[12]||(e[12]=u("div",null,[u("strong",null,"2. 添加 Webhook，配置如下：")],-1)),r(l(ue),{bordered:"",column:1,size:"small",style:{margin:"8px 0"}},{default:t(()=>[r(l(I),{label:"网址"},{default:t(()=>[r(l(V),{code:""},{default:t(()=>[s(c(z.value)+"/webhook/emby",1)]),_:1}),r(l(V),{depth:"3"},{default:t(()=>[...e[8]||(e[8]=[s("（Jellyfin 用 /webhook/jellyfin）",-1)])]),_:1})]),_:1}),r(l(I),{label:"请求内容类型"},{default:t(()=>[r(l(A),{type:"success"},{default:t(()=>[...e[9]||(e[9]=[s("application/json",-1)])]),_:1})]),_:1}),r(l(I),{label:"事件类型"},{default:t(()=>[r(l(v),null,{default:t(()=>[r(l(A),{type:"info"},{default:t(()=>[...e[10]||(e[10]=[s("✓ 媒体库 - 已添加新媒体",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e[13]||(e[13]=u("div",null,[u("strong",null,'3. 保存后点击"发送测试通知"验证')],-1))]),_:1})]),_:1})]),_:1}),r(l(B),{title:"服务器管理"},{"header-extra":t(()=>[r(l(x),{type:"primary",onClick:K},{icon:t(()=>[r(l(M),{component:l(re)},null,8,["component"])]),default:t(()=>[e[14]||(e[14]=s(" 添加服务器 ",-1))]),_:1})]),default:t(()=>[r(l(se),{show:j.value},{default:t(()=>[h.value.length>0?(f(),_(l(ie),{key:0,bordered:""},{default:t(()=>[(f(!0),N(X,null,Y(h.value,(a,w)=>(f(),_(l(de),{key:a.name},{default:t(()=>[r(l(pe),null,{header:t(()=>[r(l(v),{align:"center"},{default:t(()=>[s(c(a.name)+" ",1),r(l(A),{type:a.type==="emby"?"success":"info",size:"small"},{default:t(()=>[s(c(a.type.toUpperCase()),1)]),_:2},1032,["type"])]),_:2},1024)]),description:t(()=>[r(l(v),{vertical:"",size:"small"},{default:t(()=>{var y;return[u("div",null,[e[15]||(e[15]=u("strong",null,"URL:",-1)),s(" "+c(a.url),1)]),u("div",null,[e[16]||(e[16]=u("strong",null,"API Key:",-1)),s(" "+c($(a.api_key)),1)]),(y=a.exclude_libraries)!=null&&y.length?(f(),N("div",be,[e[17]||(e[17]=u("strong",null,"排除媒体库:",-1)),s(" "+c(a.exclude_libraries.join(", ")),1)])):Z("",!0)]}),_:2},1024)]),action:t(()=>[r(l(v),null,{default:t(()=>[r(l(x),{size:"small",onClick:y=>R(w)},{icon:t(()=>[r(l(M),{component:l(ge)},null,8,["component"])]),default:t(()=>[e[18]||(e[18]=s(" 编辑 ",-1))]),_:1},8,["onClick"]),r(l(x),{size:"small",type:"error",onClick:y=>F(w)},{icon:t(()=>[r(l(M),{component:l(he)},null,8,["component"])]),default:t(()=>[e[19]||(e[19]=s(" 删除 ",-1))]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})):(f(),_(l(fe),{key:1,description:"暂无服务器，点击上方按钮添加"}))]),_:1},8,["show"])]),_:1}),r(l(ee),{show:g.value,"onUpdate:show":e[6]||(e[6]=a=>g.value=a),preset:"dialog",title:d.value===-1?"添加服务器":"编辑服务器"},{action:t(()=>[r(l(v),null,{default:t(()=>[r(l(x),{onClick:e[5]||(e[5]=a=>g.value=!1)},{default:t(()=>[...e[22]||(e[22]=[s("取消",-1)])]),_:1}),r(l(x),{type:"primary",onClick:W,loading:E.value},{default:t(()=>[...e[23]||(e[23]=[s("保存",-1)])]),_:1},8,["loading"])]),_:1})]),default:t(()=>[r(l(ve),{ref_key:"formRef",ref:U,model:o.value,rules:O,"label-placement":"left","label-width":"100"},{default:t(()=>[r(l(C),{label:"服务器名称",path:"name"},{default:t(()=>[r(l(S),{value:o.value.name,"onUpdate:value":e[0]||(e[0]=a=>o.value.name=a),placeholder:"例如：我的Emby"},null,8,["value"])]),_:1}),r(l(C),{label:"服务器类型",path:"type"},{default:t(()=>[r(l(ne),{value:o.value.type,"onUpdate:value":e[1]||(e[1]=a=>o.value.type=a)},{default:t(()=>[r(l(D),{value:"emby"},{default:t(()=>[...e[20]||(e[20]=[s("Emby",-1)])]),_:1}),r(l(D),{value:"jellyfin"},{default:t(()=>[...e[21]||(e[21]=[s("Jellyfin",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),r(l(C),{label:"服务器地址",path:"url"},{default:t(()=>[r(l(S),{value:o.value.url,"onUpdate:value":e[2]||(e[2]=a=>o.value.url=a),placeholder:"http://192.168.1.100:8096"},{prefix:t(()=>[r(l(M),{component:l(ye)},null,8,["component"])]),_:1},8,["value"])]),_:1}),r(l(C),{label:"API Key",path:"api_key"},{default:t(()=>[r(l(S),{value:o.value.api_key,"onUpdate:value":e[3]||(e[3]=a=>o.value.api_key=a),type:"password","show-password-on":"click",placeholder:d.value===-1?"从媒体服务器后台获取":"留空不修改"},null,8,["value","placeholder"])]),_:1}),r(l(C),{label:"排除媒体库"},{default:t(()=>[r(l(ae),{value:o.value.exclude_libraries,"onUpdate:value":e[4]||(e[4]=a=>o.value.exclude_libraries=a)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title"])]),_:1}))}};export{Ae as default};
