{
  "permissions": {
    "allow": [
      "mcp__ace-tool__enhance_prompt",
      "mcp__ace-tool__search_context",
      "Bash(app/generator/__init__.py <<'GENERATOR_INIT'\nimport logging\nfrom pathlib import Path\nfrom typing import Optional, Tuple\n\nfrom app.config import Config\nfrom app.generator.style_single_1 import create_style_single_1\nfrom app.generator.style_single_2 import create_style_single_2\nfrom app.generator.style_multi_1 import create_style_multi_1\n\nlogger = logging.getLogger\\(__name__\\)\n\n\ndef generate_cover\\(\n    library_dir: Path,\n    title: Tuple[str, str],\n    font_paths: Tuple[str, str],\n    config: Config\n\\) -> Optional[str]:\n    \"\"\"\n    生成封面\n\n    Args:\n        library_dir: 媒体库图片目录\n        title: \\(中文标题, 英文标题\\)\n        font_paths: \\(中文字体路径, 英文字体路径\\)\n        config: 配置对象\n\n    Returns:\n        Base64 编码的图片数据，失败返回 None\n    \"\"\"\n    style = config.cover.style\n\n    try:\n        if style == \"single_1\":\n            params = config.style_params.single\n            font_size = \\(config.fonts.main.zh_size, config.fonts.main.en_size\\)\n            return create_style_single_1\\(\n                str\\(library_dir\\),\n                title,\n                font_paths,\n                font_size=font_size,\n                blur_size=params.blur_size,\n                color_ratio=params.color_ratio\n            \\)\n        elif style == \"single_2\":\n            params = config.style_params.single\n            font_size = \\(config.fonts.main.zh_size, config.fonts.main.en_size\\)\n            return create_style_single_2\\(\n                str\\(library_dir\\),\n                title,\n                font_paths,\n                font_size=font_size,\n                blur_size=params.blur_size,\n                color_ratio=params.color_ratio\n            \\)\n        elif style == \"multi_1\":\n            params = config.style_params.multi_1\n            if config.fonts.multi_1.use_main_font:\n                font_size = \\(config.fonts.main.zh_size, config.fonts.main.en_size\\)\n            else:\n                font_size = \\(config.fonts.multi_1.zh_size, config.fonts.multi_1.en_size\\)\n            return create_style_multi_1\\(\n                library_dir,\n                title,\n                font_paths,\n                font_size=font_size,\n                is_blur=params.blur,\n                blur_size=params.blur_size,\n                color_ratio=params.color_ratio\n            \\)\n        else:\n            logger.error\\(f\"Unknown cover style: {style}\"\\)\n            return None\n    except Exception as e:\n        logger.error\\(f\"Failed to generate cover: {e}\", exc_info=True\\)\n        return None\nGENERATOR_INIT)",
      "Bash(.gitignore <<'GITIGNORE'\n# Python\n__pycache__/\n*.py[cod]\n*$py.class\n*.so\n.Python\nbuild/\ndevelop-eggs/\ndist/\ndownloads/\neggs/\n.eggs/\nlib/\nlib64/\nparts/\nsdist/\nvar/\nwheels/\n*.egg-info/\n.installed.cfg\n*.egg\nMANIFEST\n\n# Virtual Environment\nvenv/\nENV/\nenv/\n\n# IDE\n.vscode/\n.idea/\n*.swp\n*.swo\n*~\n\n# Data\ndata/\n*.log\n\n# Config\nconfig.yaml\n\n# OS\n.DS_Store\nThumbs.db\n\n# Frontend\nfrontend/node_modules/\nfrontend/dist/\nfrontend/.vite/\n\n# Docker\n.dockerignore\nGITIGNORE)",
      "Bash(python:*)",
      "Bash(git commit:*)",
      "Bash(git push:*)",
      "Bash(dir \"C:\\\\github_repo\\\\library-poster\\\\MoviePilot-Plugins-main\"\")",
      "Bash(C:github_repolibrary-posterstandaloneinstall.sh << 'EOF'\n#!/bin/bash\n# Library Poster 轻量版安装脚本\n\nset -e\n\necho \"=== Library Poster 轻量版安装 ===\"\necho \"\"\n\n# 检查 Python\nif ! command -v python3 &> /dev/null; then\n    echo \"错误: 未找到 python3，请先安装 Python 3.11+\"\n    exit 1\nfi\n\n# 获取项目路径\nSCRIPT_DIR=\"$\\( cd \"$\\( dirname \"${BASH_SOURCE[0]}\" \\)\" && pwd \\)\"\nPROJECT_DIR=\"$\\( cd \"$SCRIPT_DIR/..\" && pwd \\)\"\n\necho \"项目路径: $PROJECT_DIR\"\necho \"\"\n\n# 安装依赖\necho \"正在安装 Python 依赖...\"\npip3 install -r \"$PROJECT_DIR/requirements.txt\" --user\necho \"依赖安装完成\"\necho \"\"\n\n# 赋予执行权限\nchmod +x \"$SCRIPT_DIR/update.py\"\nchmod +x \"$SCRIPT_DIR/webhook.py\"\n\n# 选择安装方式\necho \"请选择安装方式:\"\necho \"1\\) systemd（推荐，自动启动）\"\necho \"2\\) cron（仅定时更新）\"\necho \"3\\) 手动（不配置自动启动）\"\nread -p \"请输入选项 [1-3]: \" choice\n\ncase $choice in\n    1\\)\n        echo \"\"\n        echo \"=== 配置 systemd 服务 ===\"\n        \n        cat > /tmp/library-poster-webhook.service << SEOF\n[Unit]\nDescription=Library Poster Webhook Listener\nAfter=network.target\n\n[Service]\nType=simple\nUser=$USER\nWorkingDirectory=$PROJECT_DIR\nExecStart=$SCRIPT_DIR/webhook.py\nRestart=always\nRestartSec=10\nStandardOutput=journal\nStandardError=journal\nMemoryMax=100M\nCPUQuota=20%\n\n[Install]\nWantedBy=multi-user.target\nSEOF\n\n        cat > /tmp/library-poster-update.service << SEOF\n[Unit]\nDescription=Library Poster Cover Update\nAfter=network.target\n\n[Service]\nType=oneshot\nUser=$USER\nWorkingDirectory=$PROJECT_DIR\nExecStart=$SCRIPT_DIR/update.py\nStandardOutput=journal\nStandardError=journal\nSEOF\n\n        cat > /tmp/library-poster-update.timer << SEOF\n[Unit]\nDescription=Library Poster Update Timer\nRequires=library-poster-update.service\n\n[Timer]\nOnCalendar=daily\nOnCalendar=02:00\nPersistent=true\n\n[Install]\nWantedBy=timers.target\nSEOF\n\n        echo \"服务文件已生成在 /tmp/\"\n        echo \"\"\n        echo \"请以 root 权限执行以下命令完成安装:\"\n        echo \"  sudo cp /tmp/library-poster-*.* /etc/systemd/system/\"\n        echo \"  sudo systemctl daemon-reload\"\n        echo \"  sudo systemctl enable --now library-poster-webhook.service\"\n        echo \"  sudo systemctl enable --now library-poster-update.timer\"\n        ;;\n\n    2\\)\n        echo \"\"\n        echo \"=== 配置 cron 定时任务 ===\"\n        echo \"请添加到 crontab \\(crontab -e\\):\"\n        echo \"  0 2 * * * cd $PROJECT_DIR && $SCRIPT_DIR/update.py\"\n        ;;\n\n    3\\)\n        echo \"\"\n        echo \"=== 手动使用 ===\"\n        echo \"定时更新: $SCRIPT_DIR/update.py\"\n        echo \"Webhook: $SCRIPT_DIR/webhook.py\"\n        ;;\nesac\n\necho \"\"\necho \"=== 安装完成 ===\"\nEOF)",
      "Bash(chmod +x C:github_repolibrary-posterstandaloneinstall.sh)"
    ]
  }
}
